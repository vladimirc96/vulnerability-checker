package com.master.vulnerabilitychecker.dto;

import com.master.vulnerabilitychecker.dto.builder.VulnerabilityDTOBuilder;
import com.master.vulnerabilitychecker.model.Repository;

import java.util.ArrayList;
import java.util.List;

public class VulnerabilityDTO {

    private String cveId;
    private String name;
    private String description;
    private List<String> references = new ArrayList<>();
    private String infoUrl;
    private String severityV2;
    private String severityV3;
    private RepositoryDTO repositoryDTO;

    public VulnerabilityDTO() {
    }

    public VulnerabilityDTO(String cveId, String name, String description, String references, String severityV2, String severityV3) {
        this.cveId = cveId;
        this.name = name;
        this.description = description;
        this.setReferences(references);
        this.infoUrl = "https://nvd.nist.gov/vuln/detail/" + cveId;
        this.severityV2 = severityV2;
        this.severityV3 = severityV3;
    }

    public VulnerabilityDTO(String cveId, String name, String description, String references, String severityV2, String severityV3, Repository repository) {
        this.cveId = cveId;
        this.name = name;
        this.description = description;
        this.setReferences(references);
        this.infoUrl = "https://nvd.nist.gov/vuln/detail/" + cveId;
        this.severityV2 = severityV2;
        this.severityV3 = severityV3;
        this.repositoryDTO = new RepositoryDTO(repository.getId(), repository.getName(), repository.getUrl(), repository.getOwnerName());
    }

    public VulnerabilityDTO(VulnerabilityDTOBuilder vulnerabilityDTOBuilder) {
        this.cveId = vulnerabilityDTOBuilder.getCveId();
        this.name = vulnerabilityDTOBuilder.getName();
        this.description = vulnerabilityDTOBuilder.getDescription();
        this.setReferences(vulnerabilityDTOBuilder.getReferences());
        this.infoUrl = vulnerabilityDTOBuilder.getInfoUrl();
        this.severityV2 = vulnerabilityDTOBuilder.getSeverityV2();
        this.severityV3 = vulnerabilityDTOBuilder.getSeverityV3();
        this.repositoryDTO = vulnerabilityDTOBuilder.getRepositoryDTO();
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getCveId() {
        return cveId;
    }

    public void setCveId(String cveId) {
        this.cveId = cveId;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public List<String> getReferences() {
        return references;
    }

    public void setReferences(String references) {
        String[] refs = references.split(",");
        for (int i = 0; i < refs.length; i++) {
            if (refs[i] != null) {
                this.references.add(refs[i]);
            }
        }
    }

    public String getInfoUrl() {
        return infoUrl;
    }

    public void setInfoUrl(String cveId) {
        this.infoUrl = "https://nvd.nist.gov/vuln/detail/" + cveId;
    }

    public RepositoryDTO getRepositoryDTO() {
        return repositoryDTO;
    }

    public void setRepositoryDTO(RepositoryDTO repositoryDTO) {
        this.repositoryDTO = repositoryDTO;
    }

    public void setReferences(List<String> references) {
        this.references = references;
    }

    public String getSeverityV2() {
        return severityV2;
    }

    public void setSeverityV2(String severityV2) {
        this.severityV2 = severityV2;
    }

    public String getSeverityV3() {
        return severityV3;
    }

    public void setSeverityV3(String severityV3) {
        this.severityV3 = severityV3;
    }
}
