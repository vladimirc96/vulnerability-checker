package com.master.vulnerabilitychecker.dto.builder;

import com.master.vulnerabilitychecker.dto.RepositoryDTO;
import com.master.vulnerabilitychecker.dto.VulnerabilityDTO;
import com.master.vulnerabilitychecker.model.Repository;

import java.util.ArrayList;
import java.util.List;

public final class VulnerabilityDTOBuilder {

    private String cveId;
    private String name;
    private String description;
    private List<String> references = new ArrayList<>();
    private String infoUrl;
    private String severityV2;
    private String severityV3;
    private RepositoryDTO repositoryDTO;

    public VulnerabilityDTOBuilder cveId(String cveId) {
        this.cveId = cveId;
        return this;
    }

    public VulnerabilityDTOBuilder name(String name) {
        this.name = name;
        return this;
    }

    public VulnerabilityDTOBuilder description(String description) {
        this.description = description;
        return this;
    }

    public VulnerabilityDTOBuilder references(String references) {
        String[] refs = references.split(",");
        for(int i = 0; i < refs.length; i++){
            if(!refs[i].equals("null")){
                this.references.add(refs[i]);
            }
        }
        return this;
    }

    public VulnerabilityDTOBuilder infoUrl(String cveId) {
        this.infoUrl = "https://nvd.nist.gov/vuln/detail/" + cveId;
        return this;
    }

    public VulnerabilityDTOBuilder severityV2(String severityV2) {
        this.severityV2 = severityV2;
        return this;
    }

    public VulnerabilityDTOBuilder severityV3(String severityV3) {
        this.severityV3 = severityV3;
        return this;
    }

    public VulnerabilityDTOBuilder repositoryDTO(Repository repository) {
        this.repositoryDTO = new RepositoryDTO(repository.getId(), repository.getName(), repository.getUrl(), repository.getOwnerName());
        return this;
    }

    public VulnerabilityDTO build() {
        return new VulnerabilityDTO(this);
    }

    public String getCveId() {
        return cveId;
    }

    public String getName() {
        return name;
    }

    public String getDescription() {
        return description;
    }

    public List<String> getReferences() {
        return references;
    }

    public String getInfoUrl() {
        return infoUrl;
    }

    public String getSeverityV2() {
        return severityV2;
    }

    public String getSeverityV3() {
        return severityV3;
    }

    public RepositoryDTO getRepositoryDTO() {
        return repositoryDTO;
    }
}
