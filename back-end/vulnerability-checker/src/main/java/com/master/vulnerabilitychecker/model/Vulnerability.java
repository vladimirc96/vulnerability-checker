package com.master.vulnerabilitychecker.model;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.master.vulnerabilitychecker.model.builder.VulnerabilityBuilder;
import com.master.vulnerabilitychecker.model.ids.VulnerabilityId;

import javax.persistence.*;
import java.util.List;

@Entity
@Table(name = "vulnerabilities")
public class Vulnerability {

    @EmbeddedId
    private VulnerabilityId id;

    @Column(name = "name")
    private String name;

    @Lob
    private String description;

    @Lob
    private String referenceUrls;

    @Column(name = "info_url")
    private String infoUrl;

    @Column(name = "severity_v2")
    private String severityV2;

    @Column(name = "severity_v3")
    private String severityV3;

    @JsonIgnore
    @ManyToOne
    private Repository repository;

    public Vulnerability() {

    }

    public Vulnerability(VulnerabilityBuilder builder) {
        this.id = builder.getId();
        this.name = builder.getName();
        this.description = builder.getDescription();
        this.setReferenceUrls(builder.getReferenceUrls());
        this.infoUrl = builder.getInfoUrl();
        this.severityV2 = builder.getSeverityV2();
        this.severityV3 = builder.getSeverityV3();
    }

    public Vulnerability(String cveId, String name, String description, List<String> referenceUrls, String infoUrl, String severityV2, String severityV3) {
        this.name = name;
        this.description = description;
        this.setReferenceUrls(referenceUrls);
        this.infoUrl = infoUrl;
        this.severityV2 = severityV2;
        this.severityV3 = severityV3;
    }

    public VulnerabilityId getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public String getReferenceUrls() {
        return referenceUrls;
    }

    public void setReferenceUrls(List<String> references) {
        for (String ref : references) {
            if (ref != null) {
                this.referenceUrls += "," + ref;
            }
        }
    }

    public String getInfoUrl() {
        return infoUrl;
    }

    public void setInfoUrl(String infoUrl) {
        this.infoUrl = infoUrl;
    }

    public Repository getRepository() {
        return repository;
    }

    public void setRepository(Repository repository) {
        this.repository = repository;
    }

    public String getSeverityV2() {
        return severityV2;
    }

    public void setSeverityV2(String severityV2) {
        this.severityV2 = severityV2;
    }

    public String getSeverityV3() {
        return severityV3;
    }

    public void setSeverityV3(String severityV3) {
        this.severityV3 = severityV3;
    }
}
