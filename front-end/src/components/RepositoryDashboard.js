import React, {Component} from 'react';
import StatisticTable from './tables/StatisticTable';
import SeverityV2Piechart from './charts/SeverityV2Piechart';
import SeverityV3Piechart from './charts/SeverityV3Piechart';
import vulnerabilityService from '../service/VulnerabilityService';
import RepositoryStatisticTable from './tables/RepositoryStatisticTable';

const colStyle={
    padding: "20px",
    width: "50%"
}

class RepositoryDashboard extends Component {

    constructor(props){
        super();
        this.state = {
            dataV2 : {
                highList: [],
                mediumlist: [],
                lowList: []
            },
            dataV3: {
                criticalList: [],
                highList: [],
                mediumlist: [],
                lowList: []
            }
        }
    }
    
    componentDidMount(){
        vulnerabilityService.findAllByCvssV3AndRepoId(this.props.match.params.repoId).then(
            (data) => {
                this.setState(
                    {
                        dataV3 : {
                            criticalList: data.criticalList,
                            highList: data.highList,
                            mediumlist: data.mediumlist,
                            lowList: data.lowList
                        }
                    }
                )
            }
        ).catch(error => {alert(error)});

        vulnerabilityService.findAllByCvssV2AndRepoId(this.props.match.params.repoId).then(
            (data) => {
                this.setState(
                    {
                        dataV2: {
                            highList: data.highList,
                            mediumlist: data.mediumlist,
                            lowList: data.lowList
                        }
                    }
                )
            }
        ).catch(error => {alert(error)});

    }

    render() {
        return (
            <div className="row">
                <div style={colStyle}>
                    <RepositoryStatisticTable repoId={this.props.match.params.repoId}/>
                </div>
                
                <div id="piecharts" style={colStyle}>
                    <SeverityV3Piechart data={this.state.dataV3}/>
                    <SeverityV2Piechart data={this.state.dataV2}/>
                </div>
                
            </div>
        )
    }

}

export default RepositoryDashboard;