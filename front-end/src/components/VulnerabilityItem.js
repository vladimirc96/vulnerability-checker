 import React, {Component} from 'react';
import vulnerabilityService from '../service/VulnerabilityService';

const rowStyle = {
    marginBottom: "50px",
}

const linkStyle = {
    fontSize: "15px",
    width: "100%",
    marginBottom: "4px"
}

const criticalSeverityBox = {
    marginLeft: "10px",
    height: "40px",
    width: "70px",
    color:  "#000000",
    border: "2px solid #000000",
    borderRadius: "10px",
    padding: "2px",
    fontWeight: "500",
}

const highSeverityBox = {
    marginLeft: "10px",
    height: "40px",
    width: "70px",
    color:  "#C12E2A",
    border: "2px solid #C12E2A",
    borderRadius: "10px",
    padding: "2px",
    fontWeight: "500",
}

const mediumSeverityBox = {
    marginLeft: "10px",
    height: "40px",
    width: "90px",
    color:  "#EC971E",
    border: "2px solid #EC971E",
    borderRadius: "10px",
    padding: "2px",
    fontWeight: "500"
}

const lowSeverityBox = {
    marginLeft: "10px",
    height: "40px",
    width: "70px",
    color:  "#E3CC12",
    border: "2px solid #E3CC12",
    borderRadius: "10px",
    padding: "2px",
    fontWeight: "500"
}

class VulnerabilityItem extends Component {

    constructor(props){
        super(props);
        this.state = { vulnerability: {} };
    }

    componentDidMount(){
        vulnerabilityService.findOneById(this.props.match.params.cveId, this.props.match.params.repoId).then(
            (vulnerability) => {
                this.setState({vulnerability: vulnerability})
            }
        ).catch(error => alert(error));
    }

    render(){
        let references = [];
        if(this.state.vulnerability.references != undefined){
            references = this.state.vulnerability.references.map(
                url => {
                    return (
                        url !== null ?
                        <div style={linkStyle}>
                                <a href={url} target="_blank">{url}</a> 
                        </div>
                        : ""
                    )
                }
            )
        }

        return (
            <div className="container d-flex flex-column">
                <div className="row" style={rowStyle}>
                    <h1 className="d-flex flex-fill" style={{marginBottom: "23px"}}> <a href={this.state.vulnerability.infoUrl} target="_blank">{this.state.vulnerability.cveId}</a>  Detail</h1>
                    <div className="d-flex flex-column align-items-start justify-content-end">
                            { this.state.vulnerability.severityV2 == 'HIGH' ? <div className="d-flex flex-row align-items-center"> V2: <span className="d-flex justify-content-center align-items-center" style={highSeverityBox}>high</span> </div>   : "" }
                            { this.state.vulnerability.severityV2 == 'MEDIUM' ? <div className="d-flex flex-row align-items-center"> V2: <span className="d-flex justify-content-center align-items-center" style={mediumSeverityBox}>medium</span> </div>   : ""  }
                            { this.state.vulnerability.severityV2 == 'LOW' ? <div className="d-flex flex-row align-items-center"> V2: <span className="d-flex justify-content-center align-items-center" style={lowSeverityBox}>low</span> </div>   : ""  }

                            { this.state.vulnerability.severityV3 == 'CRITICAL' ? <div className="d-flex flex-row align-items-center"> V3: <span className="d-flex justify-content-center align-items-center" style={criticalSeverityBox}>critical</span> </div>   : ""  }
                            { this.state.vulnerability.severityV3 == 'HIGH' ? <div className="d-flex flex-row align-items-center"> V3: <span className="d-flex justify-content-center align-items-center" style={highSeverityBox}>high</span> </div>   : ""  }
                            { this.state.vulnerability.severityV3 == 'MEDIUM' ? <div className="d-flex flex-row align-items-center"> V3: <span className="d-flex justify-content-center align-items-center" style={mediumSeverityBox}>medium</span> </div>   : ""  }
                            { this.state.vulnerability.severityV3 == 'LOW' ? <div className="d-flex flex-row align-items-center"> V3: <span className="d-flex justify-content-center align-items-center" style={lowSeverityBox}>low</span> </div>   : ""  }
                    </div>
                </div>
                <div className="row" style={rowStyle}>
                    <h2>Description</h2>
                    <p>{this.state.vulnerability.description}</p>
                </div>
                <div className="row" style={rowStyle}>
                    <h2>References to Advisiories, Solutions and Tools</h2>
                    {references}
                </div>
            </div>
        )

    }

}

export default VulnerabilityItem;