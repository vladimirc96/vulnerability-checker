import React, {Component} from 'react';
import RepositoryList from './RepositoryList';
import RepositoryForm from './forms/RepositoryForm';
import repositoryService from '../service/RepositoryService';

class Repositories extends Component {

    constructor(){
        super();
        this.state = {
            repositories: []
        }
    }

    componentDidMount(){
        repositoryService.findAll().then(
            (repos) => {
                this.setState({repositories: repos});
                console.log("component did mount");
                console.log(this.state);
            }
        )
    }

    addRepository = (repo) => {
        this.setState(prevState => {
            let prevRepos = prevState.repositories;
            prevRepos.push(repo);
            return { 
                repositories: prevRepos
            }
        });
        
    }

    render() {
        const repos = this.state.repositories;
        console.log("Repositories rendering");
        console.log(this.state);
        return(
                <div>
                    <div>
                        <RepositoryForm addRepository={this.addRepository}/>
                    </div>
                    <div>
                        <RepositoryList repositories={this.state.repositories}/>
                    </div>
                </div>
        )
    }
}

export default Repositories;