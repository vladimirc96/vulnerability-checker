import React, {Component} from 'react';
import vulnerabilityService from '../service/VulnerabilityService';
import Pagination from '../components/Pagination';
import {Link} from 'react-router-dom';
class VulnerabilityList extends Component {

    constructor(){
        super();
        this.state = {
            vulnerabilities: [],
            pageOfItems: []
        }
    }

    componentDidMount(){
        vulnerabilityService.findAll().then(
            data => {
                this.setState({vulnerabilities: data});
            }
        ).catch(error => { alert(error) });
        
    }

    onChangePage = (pageOfItems) => {
        this.setState({pageOfItems: pageOfItems})
    }

    render() {
        
        const vulnerabilityList = this.state.pageOfItems.map(
            vulnerability => {
                return(
                    <div key={vulnerability.cveId} style={{marginBottom: "17px"}}>
                        <div className="d-flex Box-row--drag-hide position-relative">
                            <div className="d-flex flex-column flex-auto p-2 pr-3 min-width-0 lh-condensed" style={{width:"100%"}}>
                            <div className="d-flex flex-column flex-md-row lh-condensed flex-auto min-width-0">
                                <p className="h4 flex-auto min-width-0" style={{color: "#2C56C7"}}>
                                {vulnerability.name}
                                </p>
                            </div>

                            <div className="d-flex flex-wrap text-small text-gray" style={{color: "#858796"}}>
                                <span className="pr-3 pt-2">
                                <i className="fa fa-user-circle"></i> {vulnerability.repositoryDTO.ownerName}
                                </span>

                                <span className="pr-3 pt-2 min-width-0">
                                    <i className="fa fa-archive"></i> {vulnerability.repositoryDTO.name}
                                </span>

                            </div>
                            </div>
                      
                            <div className="d-flex flex-column pl-md-2 pt-2 pt-md-0 flex-shrink-0">
                                <span title="CVE id" className="Label Label--orange" style={{marginBottom: "5px"}}>
                                    {vulnerability.cveId}
                                </span>
                                <Link to={`/home/vulnerabilities/${vulnerability.cveId}`}>
                                    <button className="btn btn-primary">Details</button>
                                </Link>
                            </div>
                        </div>
                     </div>
                     
                )
            }
        )

        return(
            <div className="container d-flex flex-column">
                { vulnerabilityList }
                <div style={{position: "fixed", bottom: "0", left: "45%"}}>
                    <Pagination items={this.state.vulnerabilities} onChangePage={this.onChangePage} />
                </div>
            </div>
        )
    }
}

export default VulnerabilityList;